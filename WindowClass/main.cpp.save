#define   DEBUG_1
#include "Make.h"
#include "RadioButtonSystem.cpp"

const COLORREF WINDOW_COLOR = RGB (212, 208, 200);

void function_ (void*, void* pt, WPARAM, LPARAM)
{
    const int MaxStringLen = 100;
    wchar_t str[MaxStringLen] = L"";
    reinterpret_cast<EditBox*> (pt) -> GetText (str, MaxStringLen);
    wprintf (L"BUTTON PRESSED\n{\n  EditBox contains:\n  \"%s\"\n}\n", str);
}

void function1_ (void*, void* pt, WPARAM, LPARAM)
{
    *((bool*)pt) = false;
}

POINT GetCenteredWindowPos (int width, int height)
{
    SIZE scr = { GetSystemMetrics (SM_CXSCREEN), GetSystemMetrics (SM_CYSCREEN) };
    RECT r   = { 0, 0, 800, 600 }; AdjustWindowRect (&r, STYLE_CONST | WS_CLIPCHILDREN, false);
    SIZE sz  = { r.right - r.left, r.bottom - r.top };
    POINT p = {scr.cx/2 - sz.cx/2, scr.cy/2 - sz.cy/2};
    return p;
}

int WINAPI WinMain(HINSTANCE hInst,HINSTANCE hPrev, LPSTR CmdLine,int CmdShow)
{
    srand (time (NULL));
    POINT p = GetCenteredWindowPos(800, 600);
    ApplicationWindow app (p.x, p.y,
                           800, 600,
                           STYLE_CONST | WS_CLIPCHILDREN,
                           L"Психологический тест", true, false);
    DeleteObject (SelectObject (HDC (app), CreateSolidBrush (WINDOW_COLOR)));
    PatBlt (HDC (app), 0, 0, ScreenSize.x, ScreenSize.y, PATCOPY);
    {
        const int xStart = 10, xButton = 150;
        const int yStart = 20, yButton = 50;
        const int xEdit = 780, yEdit = 20;
        const int yJump = 10;
        const int xButtonC = 100, yButtonC = 30;

        EditBox e1 (xStart, yStart,
                    xEdit, yEdit,
                    L"I Сколько времени в среднем в день Вы тратите на выполнение домашнего задания?",
                    WS_VISIBLE | WS_CHILD | ES_READONLY | ES_AUTOHSCROLL,
                    0,
                    &app,
                    NULL,
                    NULL);

        #define __SET_BUTTON__(n, str, x, y, width, height, questionNum) \
        question##questionNum##buttons[n] = new Button (x, y, \
                                                        width, 50, \
                                                        L##str, \
                                                        WS_TABSTOP | WS_VISIBLE | WS_CHILD | BS_RADIOBUTTON | BS_MULTILINE, \
                                                        0, \
                                                        &app, \
                                                        RBSManagementCallback, \
                                                        &(rbs##questionNum))

        RadioButtonSystem rbs1;
        Button* question1buttons[5] = {};
        __SET_BUTTON__ (0, "1 до 1,5 ч.", xStart + 0*xButton, yStart + yEdit, xButton, yButton, 1);
        __SET_BUTTON__ (1, "2 до 2,5 ч.", xStart + 1*xButton, yStart + yEdit, xButton, yButton, 1);
        __SET_BUTTON__ (2, "3,5 до 3 ч.", xStart + 2*xButton, yStart + yEdit, xButton, yButton, 1);
        __SET_BUTTON__ (3, "более 3 ч.",  xStart + 3*xButton, yStart + yEdit, xButton, yButton, 1);
        __SET_BUTTON__ (4, "не делаю дз", xStart + 4*xButton, yStart + yEdit, xButton, yButton, 1);
        rbs1.Set (question1buttons, 5);

        EditBox e2 (xStart, yStart + yEdit + yButton + yJump,
                    xEdit, yEdit * 2,
                    L"II Сколько времени в среднем в день Вы тратите на дорогу до школы и обратно? ",
                    WS_VISIBLE | WS_CHILD | ES_READONLY | ES_MULTILINE,
                    0,
                    &app,
                    NULL,
                    NULL);

        RadioButtonSystem rbs2;
        Button* question2buttons[5] = {};
        __SET_BUTTON__ (0, "Менее 30 мин",    xStart + 0*xButton,
                        yStart + 3*yEdit + yButton + yJump, xButton, yButton, 2);
        __SET_BUTTON__ (1, "30 мин – 1 час",  xStart + 1*xButton,
                        yStart + 3*yEdit + yButton + yJump, xButton, yButton, 2);
        __SET_BUTTON__ (2, "1 час – 2 часа",  xStart + 2*xButton,
                        yStart + 3*yEdit + yButton + yJump, xButton, yButton, 2);
        __SET_BUTTON__ (3, "2 часа – 3 часа", xStart + 3*xButton,
                        yStart + 3*yEdit + yButton + yJump, xButton, yButton, 2);
        __SET_BUTTON__ (4, "более 3-х часов", xStart + 4*xButton,
                        yStart + 3*yEdit + yButton + yJump, xButton, yButton, 2);
        rbs2.Set (question2buttons, 5);

        EditBox e3a (xStart, yStart + 3*yEdit + 2*yButton + 2*yJump,
                     xEdit, yEdit * 3,
                     L"III Остаетесь ли Вы на дополнительные занятия в классе, чтобы лучше разобраться в материале уроков или переписать неудачные контрольные работы?",
                     WS_VISIBLE | WS_CHILD | ES_READONLY | ES_MULTILINE,
                     0,
                     &app,
                     NULL,
                     NULL);

        RadioButtonSystem rbs3a;
        Button* question3abuttons[2] = {};
        __SET_BUTTON__ (0, "Да",  xStart + 0*xButton, yStart + 6*yEdit + 2*yButton + 2*yJump, xButton, yButtonC, 3a);
        __SET_BUTTON__ (1, "Нет", xStart + 1*xButton, yStart + 6*yEdit + 2*yButton + 2*yJump, xButton, yButtonC, 3a);
        rbs3a.Set (question3abuttons, 2);

        EditBox e3b (xStart, yStart + 6*yEdit + 3*yButton + 3*yJump,
                     xEdit, yEdit,
                     L"   Сколько раз в неделю в среднем?",
                     WS_VISIBLE | WS_CHILD | ES_READONLY | ES_MULTILINE,
                     0,
                     &app,
                     NULL,
                     NULL);

        RadioButtonSystem rbs3b;
        Button* question3bbuttons[6] = {};
        __SET_BUTTON__ (0, "1", 4*xStart + 0*xButtonC,
                        yStart + 7*yEdit + 2*yButton + yButtonC + 3*yJump, xButtonC, 3b);

        __SET_BUTTON__ (1, "2", 4*xStart + 1*xButtonC,
                        yStart + 7*yEdit + 3*yButton + yButtonC + 3*yJump, xButtonC, 3b);

        __SET_BUTTON__ (2, "3", 4*xStart + 2*xButtonC,
                        yStart + 7*yEdit + 3*yButton + yButtonC + 3*yJump, xButtonC, 3b);

        __SET_BUTTON__ (3, "4", 4*xStart + 3*xButtonC,
                        yStart + 7*yEdit + 3*yButton + yButtonC + 3*yJump, xButtonC, 3b);

        __SET_BUTTON__ (4, "5", 4*xStart + 4*xButtonC,
                        yStart + 7*yEdit + 3*yButton + yButtonC + 3*yJump, xButtonC, 3b);

        __SET_BUTTON__ (5, "6", 4*xStart + 5*xButtonC,
                        yStart + 7*yEdit + 3*yButton + yButtonC + 3*yJump, xButtonC, Y, 3b);

        rbs3b.Set (question3bbuttons, 6);

        #undef __SET_BUTTON__

        getch();
    }
    return 0;
}
